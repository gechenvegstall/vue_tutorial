import re
import requests
from DrissionPage import ChromiumPage
import os

os.makedirs("video")
headers={'cookie':"bd_ticket_guard_client_web_domain=2; UIFID_TEMP=3af258ad659545d9553f15cf32bb8a88df248991ebb865c20b5fa6f7dab6eb543ac3bcffd78ad5fdc7a7655c936245b8cb89d8c5439c0ea705b90c155a6d1bf84383c4fac21095b40291c552dc9e3298; hevc_supported=true; xgplayer_user_id=747498104405; fpk1=U2FsdGVkX1+77FwxmZhhWPfEbWnImEKInju0P1Ko+x+MnU0eDvDGK3PPrlKBDPWZrWcDek+IhpqqXK/AzsGtEw==; fpk2=9258db5fffd4f17a8703a19e760af505; UIFID=3af258ad659545d9553f15cf32bb8a88df248991ebb865c20b5fa6f7dab6eb54fea2dea8ceee09e0ec27850883b8cad4f91ffa2acd79fcf39ef460b26f9a031b2e10b408235cf6c1935402f60f7ef577ab63e6cd69c128d7b5f5cae3e4d23d037ba4e1059694e6a2330a350483890aca33fef4594a8efc007cc81ac08f9d7dbb3f7fa041208c0c8b231a5c1bdf9410fd4b64b60214175c10f3d4ca615390f8de; __live_version__=%221.1.2.9166%22; live_use_vvc=%22false%22; n_mh=HOrZamzGopJQPopLuPr5Oj9aA9SHm0W7Smoxtd_Sc9k; is_staff_user=false; store-region=cn-gd; store-region-src=uid; SelfTabRedDotControl=%5B%5D; SearchMultiColumnLandingAbVer=1; SEARCH_RESULT_LIST_TYPE=%22multi%22; passport_assist_user=CkFdSHwnW6SocduLZuGuHmrCzt57tdWg8h5cEbOyZFxVdTRmKT_uQap_dJipqV_mhsBYEPCpn0gFznfusCkgjHIKABpKCjwAAAAAAAAAAAAATuOsA-Ej7gUian9phGRcambK_uDiXVUN5G7IciDxFdG2tS_vp1WuEoGodMnpm3hXtiQQqoDvDRiJr9ZUIAEiAQMYBnCu; uid_tt=a3f18d420d63fa9246c6cd7c0fb9bad0; uid_tt_ss=a3f18d420d63fa9246c6cd7c0fb9bad0; sid_tt=14515ec91c9fc9442acdec06776c6fbb; sessionid=14515ec91c9fc9442acdec06776c6fbb; sessionid_ss=14515ec91c9fc9442acdec06776c6fbb; login_time=1744900652171; xgplayer_device_id=35509480476; my_rd=2; s_v_web_id=verify_matxa7kl_XH43FTYa_POUq_4WMF_8y8K_xv8giUjJErEX; __security_mc_1_s_sdk_crypt_sdk=1ec374af-4cfd-98bb; __security_mc_1_s_sdk_cert_key=40b17806-4c28-99ad; enter_pc_once=1; passport_csrf_token=ebde45ed53b61b1526fef0515d2ebef8; passport_csrf_token_default=ebde45ed53b61b1526fef0515d2ebef8; is_dash_user=1; sid_guard=14515ec91c9fc9442acdec06776c6fbb%7C1750048125%7C5184000%7CFri%2C+15-Aug-2025+04%3A28%3A45+GMT; sid_ucp_v1=1.0.0-KDA1ZjY5YmFmODRlZGEzZmY1NjdmNWEyZWQwYjdjMWFmYTY2MzYzM2YKIQjgkZDBrY29BRD9ur7CBhjvMSAMMI2HtpUGOAVA-wdIBBoCaGwiIDE0NTE1ZWM5MWM5ZmM5NDQyYWNkZWMwNjc3NmM2ZmJi; ssid_ucp_v1=1.0.0-KDA1ZjY5YmFmODRlZGEzZmY1NjdmNWEyZWQwYjdjMWFmYTY2MzYzM2YKIQjgkZDBrY29BRD9ur7CBhjvMSAMMI2HtpUGOAVA-wdIBBoCaGwiIDE0NTE1ZWM5MWM5ZmM5NDQyYWNkZWMwNjc3NmM2ZmJi; session_tlb_tag=sttt%7C3%7CFFFeyRyfyUQqzewGd2xvu_________-2OJeQJBPqHmCVYhURWln27q_zos3hztGmTE2Ig54ulEY%3D; __security_mc_1_s_sdk_sign_data_key_web_protect=2edab374-4b7e-b4d9; dy_swidth=1920; dy_sheight=1080; _bd_ticket_crypt_cookie=111dc69030789d9a0f4c89cfc1f11c59; volume_info=%7B%22isUserMute%22%3Afalse%2C%22isMute%22%3Afalse%2C%22volume%22%3A0.992%7D; EnhanceDownloadGuide=%220_0_0_0_1_1751781589%22; WallpaperGuide=%7B%22showTime%22%3A1751781594588%2C%22closeTime%22%3A0%2C%22showCount%22%3A2%2C%22cursor1%22%3A29%2C%22cursor2%22%3A8%2C%22hoverTime%22%3A1751053624685%7D; publish_badge_show_info=%221%2C0%2C0%2C1751781090501%22; strategyABtestKey=%221751826328.476%22; ttwid=1%7Ci8wAYaQB6b41l68kuYU4bWj9w_q8voZ7n7QjrnRi2rY%7C1751826331%7Ce9ecc83d0c17aee59768c435572400be0f49689515a50860aa243dddca9d8c2a; download_guide=%223%2F20250706%2F1%22; __druidClientInfo=JTdCJTIyY2xpZW50V2lkdGglMjIlM0EyOTglMkMlMjJjbGllbnRIZWlnaHQlMjIlM0E2ODYlMkMlMjJ3aWR0aCUyMiUzQTI5OCUyQyUyMmhlaWdodCUyMiUzQTY4NiUyQyUyMmRldmljZVBpeGVsUmF0aW8lMjIlM0ExJTJDJTIydXNlckFnZW50JTIyJTNBJTIyTW96aWxsYSUyRjUuMCUyMChXaW5kb3dzJTIwTlQlMjAxMC4wJTNCJTIwV2luNjQlM0IlMjB4NjQpJTIwQXBwbGVXZWJLaXQlMkY1MzcuMzYlMjAoS0hUTUwlMkMlMjBsaWtlJTIwR2Vja28pJTIwQ2hyb21lJTJGMTM4LjAuMC4wJTIwU2FmYXJpJTJGNTM3LjM2JTIwRWRnJTJGMTM4LjAuMC4wJTIyJTdE; __ac_nonce=0686b8cd700b29cfe8031; __ac_signature=_02B4Z6wo00f01k5S3-gAAIDArZ0vfvz7vf5OcttAAPwO6c; douyin.com; xg_device_score=7.683680908103623; device_web_cpu_core=12; device_web_memory_size=8; architecture=amd64; FOLLOW_NUMBER_YELLOW_POINT_INFO=%22MS4wLjABAAAAbqTLtvDyyYC_lge6UU-2vEirpOHpaimAuGyGJcwObAnzKkRYNMLEJbojXqbv7zPA%2F1751904000000%2F0%2F1751878872411%2F0%22; FOLLOW_LIVE_POINT_INFO=%22MS4wLjABAAAAbqTLtvDyyYC_lge6UU-2vEirpOHpaimAuGyGJcwObAnzKkRYNMLEJbojXqbv7zPA%2F1751904000000%2F0%2F0%2F1751879473224%22; passport_fe_beating_status=true; stream_recommend_feed_params=%22%7B%5C%22cookie_enabled%5C%22%3Atrue%2C%5C%22screen_width%5C%22%3A1920%2C%5C%22screen_height%5C%22%3A1080%2C%5C%22browser_online%5C%22%3Atrue%2C%5C%22cpu_core_num%5C%22%3A12%2C%5C%22device_memory%5C%22%3A8%2C%5C%22downlink%5C%22%3A10%2C%5C%22effective_type%5C%22%3A%5C%224g%5C%22%2C%5C%22round_trip_time%5C%22%3A50%7D%22; bd_ticket_guard_client_data=eyJiZC10aWNrZXQtZ3VhcmQtdmVyc2lvbiI6MiwiYmQtdGlja2V0LWd1YXJkLWl0ZXJhdGlvbi12ZXJzaW9uIjoxLCJiZC10aWNrZXQtZ3VhcmQtcmVlLXB1YmxpYy1rZXkiOiJCTmxrVGFXRFFqaU5DQ3VoYjFLOTJDQTdIZ1o5WEl2ZTlKWHhqUHpCNkdYL2wwa1J1M3IxaDJETGlIWmx6RlE1YWo0UE1BV1c3emdBUDNuVFdSdjdNQVE9IiwiYmQtdGlja2V0LWd1YXJkLXdlYi12ZXJzaW9uIjoyfQ%3D%3D; odin_tt=271319f9b6f2e427a25dee75fbf3b6d519a650b07984f9e16f9089f03a7ae4d281320d210b80b83771c2f680026e4e82878e23198c8bdd3947a3cf1edd24ba7d; stream_player_status_params=%22%7B%5C%22is_auto_play%5C%22%3A0%2C%5C%22is_full_screen%5C%22%3A0%2C%5C%22is_full_webscreen%5C%22%3A0%2C%5C%22is_mute%5C%22%3A0%2C%5C%22is_speed%5C%22%3A1%2C%5C%22is_visible%5C%22%3A0%7D%22; IsDouyinActive=true; home_can_add_dy_2_desktop=%220%22",
         'referer':'https://www.douyin.com/user/MS4wLjABAAAAlvntDq_3yEtiHtlBeTYOy28TN4I4_Ix4aOK-LftDAgVyFAEKA7Iuou2H043jnBr9?from_tab_name=main&vid=7501627700509461798',
         'user-agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0'}

cheom=ChromiumPage()
cheom.listen.start("aweme/post")  #监听数据包
cheom.get('https://www.douyin.com/user/MS4wLjABAAAAlvntDq_3yEtiHtlBeTYOy28TN4I4_Ix4aOK-LftDAgVyFAEKA7Iuou2H043jnBr9?from_tab_name=main&vid=7501627700509461798')
sjb=cheom.listen.wait()  #等待数据包加载

# 处理监听到的数据包
json=sjb.response.body
# print(json)
data=json["aweme_list"]

for i in data:
    video_url=i['video']['play_addr']['url_list'][0]
    title=i['desc']
    title_re=re.sub("[<>/?`~_+=.]","",title)
    res=requests.get(url=video_url,headers=headers).content
    with open('video\\'+title_re+".map4","wb")as f:
        f.write(res)
        print(title_re)